<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Figmotion</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.6;
    }
    
    .container {
      padding: 20px;
      max-width: 500px;
      margin: 0 auto;
    }
    
    h1 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #1a1a1a;
      text-align: center;
    }
    
    .section {
      background-color: white;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .section h2 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .button {
      display: block;
      width: 100%;
      padding: 10px 16px;
      margin-bottom: 8px;
      background-color: #007AFF;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .button:hover {
      background-color: #0056b3;
    }
    
    .button-secondary {
      background-color: #f0f0f0;
      color: #333;
    }
    
    .button-secondary:hover {
      background-color: #e0e0e0;
    }
    
    .button-group {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }
    
    .button-group .button {
      flex: 1;
      margin-bottom: 0;
    }
    
    .input-group {
      margin-bottom: 12px;
    }
    
    .input-group label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 4px;
      color: #666;
    }
    
    .input-group input,
    .input-group select,
    .input-group textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .input-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    .input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }
    
    .input-row .input-group {
      flex: 1;
      margin-bottom: 0;
    }
    
    .status {
      font-size: 12px;
      color: #666;
      margin-bottom: 16px;
      text-align: center;
    }
    
    .divider {
      height: 1px;
      background-color: #eee;
      margin: 16px 0;
    }
    
    .footer {
      text-align: center;
      margin-top: 20px;
      font-size: 12px;
      color: #999;
    }
    
    /* 动画列表 */
    .animation-list {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 16px;
    }
    
    .animation-item {
      padding: 12px;
      border: 1px solid #eee;
      border-radius: 6px;
      margin-bottom: 8px;
      background-color: #f9f9f9;
    }
    
    .animation-item:hover {
      background-color: #f0f0f0;
    }
    
    .animation-item h3 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .animation-item p {
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }
    
    .animation-item-actions {
      display: flex;
      gap: 4px;
    }
    
    .animation-item-actions button {
      flex: 1;
      padding: 4px 8px;
      font-size: 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: white;
      cursor: pointer;
    }
    
    .animation-item-actions button:hover {
      background-color: #f0f0f0;
    }
    
    /* 时间线 */
    .timeline {
      position: relative;
      height: 60px;
      background-color: #f0f0f0;
      border-radius: 4px;
      margin-bottom: 16px;
      overflow: hidden;
    }
    
    .timeline-track {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px;
    }
    
    .timeline-keyframe {
      position: absolute;
      width: 12px;
      height: 12px;
      background-color: #007AFF;
      border-radius: 50%;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
    }
    
    .timeline-playhead {
      position: absolute;
      width: 2px;
      height: 100%;
      background-color: #FF3B30;
      top: 0;
      left: 0;
      pointer-events: none;
    }
    
    /* 导出选项 */
    .export-options {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .export-options button {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: white;
      cursor: pointer;
    }
    
    .export-options button:hover {
      background-color: #f0f0f0;
    }
    
    /* 批量应用 */
    .batch-apply {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #eee;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Figmotion</h1>
    
    <div class="status" id="status">
      已选择 <span id="selected-node-name">无</span>
    </div>
    
    <!-- 动画列表 -->
    <div class="section">
      <h2>动画列表</h2>
      <div class="animation-list" id="animation-list">
        <!-- 动画项将通过JavaScript动态添加 -->
        <div class="animation-item" style="text-align: center; color: #999;">
          暂无动画
        </div>
      </div>
    </div>
    
    <!-- 创建动画 -->
    <div class="section">
      <h2>创建动画</h2>
      <div class="input-group">
        <label for="animation-name">动画名称</label>
        <input type="text" id="animation-name" placeholder="例如：淡入效果">
      </div>
      <div class="input-group">
        <label for="animation-type">动画类型</label>
        <select id="animation-type">
          <option value="fade">淡入淡出</option>
          <option value="move">移动</option>
          <option value="scale">缩放</option>
          <option value="rotate">旋转</option>
          <option value="custom">自定义</option>
        </select>
      </div>
      <div class="input-row">
        <div class="input-group">
          <label for="animation-duration">持续时间 (秒)</label>
          <input type="number" id="animation-duration" value="1" min="0.1" step="0.1">
        </div>
        <div class="input-group">
          <label for="animation-delay">延迟 (秒)</label>
          <input type="number" id="animation-delay" value="0" min="0" step="0.1">
        </div>
      </div>
      <div class="input-row">
        <div class="input-group">
          <label for="animation-easing">缓动函数</label>
          <select id="animation-easing">
            <option value="linear">线性</option>
            <option value="ease-in">缓入</option>
            <option value="ease-out">缓出</option>
            <option value="ease-in-out">缓入缓出</option>
            <option value="bounce">弹跳</option>
            <option value="elastic">弹性</option>
          </select>
        </div>
        <div class="input-group">
          <label for="animation-repeat">重复次数</label>
          <input type="number" id="animation-repeat" value="0" min="-1" step="1">
          <small style="display: block; font-size: 10px; color: #999;">-1 表示无限循环</small>
        </div>
      </div>
      <button class="button" id="create-animation">创建动画</button>
    </div>
    
    <!-- 时间线 -->
    <div class="section">
      <h2>时间线</h2>
      <div class="timeline" id="timeline">
        <div class="timeline-track">
          <div class="timeline-playhead" style="left: 0%"></div>
          <!-- 关键帧将通过JavaScript动态添加 -->
        </div>
      </div>
      <div class="input-row">
        <button class="button" id="add-keyframe">添加关键帧</button>
        <button class="button" id="remove-keyframe">删除关键帧</button>
      </div>
    </div>
    
    <!-- 导出选项 -->
    <div class="section">
      <h2>导出选项</h2>
      <div class="export-options">
        <button id="export-css">导出为CSS</button>
        <button id="export-json">导出为JSON</button>
        <button id="export-svg">导出为SVG</button>
      </div>
    </div>
    
    <!-- 批量应用 -->
    <div class="section">
      <h2>批量应用</h2>
      <p style="font-size: 12px; color: #666; margin-bottom: 12px;">选择多个元素并应用相同的动画效果</p>
      <button class="button button-secondary" id="batch-apply">批量应用动画</button>
    </div>
    
    <div class="divider"></div>
    
    <button class="button button-secondary" id="close">关闭</button>
    
    <div class="footer">
      Figmotion v1.0.0
    </div>
  </div>
  
  <script>
    // 动画列表
    let animations = [];
    let selectedNode = null;
    
    // 发送消息到插件
    function sendMessage(type, data = {}) {
      parent.postMessage({ pluginMessage: { type, ...data } }, '*');
    }
    
    // 监听来自插件的消息
    window.addEventListener('message', (event) => {
      if (event.data.pluginMessage) {
        const message = event.data.pluginMessage;
        if (message.type === 'init') {
          selectedNode = message.selectedNode;
          document.getElementById('selected-node-name').textContent = selectedNode ? selectedNode.name : '无';
          animations = message.animations || [];
          updateAnimationList();
        } else if (message.type === 'animations-updated') {
          animations = message.animations || [];
          updateAnimationList();
        } else if (message.type === 'export-data') {
          // 处理导出数据
          const blob = new Blob([message.data], { type: getMimeType(message.format) });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `animation.${message.format}`;
          a.click();
          URL.revokeObjectURL(url);
        }
      }
    });
    
    // 获取MIME类型
    function getMimeType(format) {
      switch (format) {
        case 'css':
          return 'text/css';
        case 'json':
          return 'application/json';
        case 'svg':
          return 'image/svg+xml';
        default:
          return 'text/plain';
      }
    }
    
    // 更新动画列表
    function updateAnimationList() {
      const list = document.getElementById('animation-list');
      if (animations.length === 0) {
        list.innerHTML = '<div class="animation-item" style="text-align: center; color: #999;">暂无动画</div>';
        return;
      }
      
      list.innerHTML = animations.map(animation => `
        <div class="animation-item">
          <h3>${animation.name}</h3>
          <p>${animation.type} | ${animation.duration}s | ${animation.easing}</p>
          <div class="animation-item-actions">
            <button onclick="previewAnimation('${animation.id}')">预览</button>
            <button onclick="applyAnimation('${animation.id}')">应用</button>
            <button onclick="deleteAnimation('${animation.id}')">删除</button>
          </div>
        </div>
      `).join('');
    }
    
    // 预览动画
    function previewAnimation(animationId) {
      sendMessage('preview-animation', { animationId });
    }
    
    // 应用动画
    function applyAnimation(animationId) {
      sendMessage('apply-animation', { animationId });
    }
    
    // 删除动画
    function deleteAnimation(animationId) {
      sendMessage('delete-animation', { animationId });
    }
    
    // 绑定事件
    document.getElementById('create-animation').addEventListener('click', () => {
      if (!selectedNode) {
        alert('请先选择一个元素');
        return;
      }
      
      const animation = {
        name: document.getElementById('animation-name').value || '新动画',
        type: document.getElementById('animation-type').value,
        duration: parseFloat(document.getElementById('animation-duration').value),
        delay: parseFloat(document.getElementById('animation-delay').value),
        easing: document.getElementById('animation-easing').value,
        repeat: parseInt(document.getElementById('animation-repeat').value),
        keyframes: [
          { time: 0, properties: { opacity: 0, x: 0, y: 0, scaleX: 1, scaleY: 1, rotation: 0 } },
          { time: 1, properties: { opacity: 1, x: 100, y: 0, scaleX: 1, scaleY: 1, rotation: 0 } }
        ],
        nodeId: selectedNode.id
      };
      
      sendMessage('create-animation', { animation });
    });
    
    document.getElementById('add-keyframe').addEventListener('click', () => {
      // 添加关键帧逻辑
      alert('关键帧添加功能开发中');
    });
    
    document.getElementById('remove-keyframe').addEventListener('click', () => {
      // 删除关键帧逻辑
      alert('关键帧删除功能开发中');
    });
    
    document.getElementById('export-css').addEventListener('click', () => {
      if (animations.length === 0) {
        alert('请先创建动画');
        return;
      }
      sendMessage('export-animation', { animationId: animations[0].id, format: 'css' });
    });
    
    document.getElementById('export-json').addEventListener('click', () => {
      if (animations.length === 0) {
        alert('请先创建动画');
        return;
      }
      sendMessage('export-animation', { animationId: animations[0].id, format: 'json' });
    });
    
    document.getElementById('export-svg').addEventListener('click', () => {
      if (animations.length === 0) {
        alert('请先创建动画');
        return;
      }
      sendMessage('export-animation', { animationId: animations[0].id, format: 'svg' });
    });
    
    document.getElementById('batch-apply').addEventListener('click', () => {
      if (animations.length === 0) {
        alert('请先创建动画');
        return;
      }
      // 这里可以实现选择多个节点的逻辑
      sendMessage('batch-apply', { animationTemplate: animations[0], nodes: [] });
    });
    
    document.getElementById('close').addEventListener('click', () => {
      sendMessage('close');
    });
  </script>
</body>
</html>