<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Figma Redlines</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #f5f5f5;
      color: #1a1a1a;
      line-height: 1.6;
    }

    .container {
      padding: 20px;
    }

    h1 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #1a1a1a;
    }

    h2 {
      font-size: 16px;
      font-weight: 600;
      margin: 20px 0 10px;
      color: #333333;
    }

    .section {
      background-color: white;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .btn {
      background-color: #0066cc;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
      margin-right: 8px;
      margin-bottom: 8px;
    }

    .btn:hover {
      background-color: #0052a3;
    }

    .btn-secondary {
      background-color: #666666;
    }

    .btn-secondary:hover {
      background-color: #525252;
    }

    .btn-danger {
      background-color: #dc3545;
    }

    .btn-danger:hover {
      background-color: #c82333;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
    }

    .annotation-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .annotation-card {
      background-color: #f9f9f9;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 12px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .annotation-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border-color: #0066cc;
    }

    .annotation-name {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .annotation-description {
      font-size: 12px;
      color: #666666;
      margin-bottom: 8px;
    }

    .color-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
    }

    .control-group {
      margin: 12px 0;
    }

    .control-row {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    .control-label {
      width: 100px;
      font-size: 13px;
      color: #333333;
    }

    .control-input {
      flex: 1;
      padding: 6px 8px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 13px;
    }

    .control-select {
      flex: 1;
      padding: 6px 8px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 13px;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 12px 0;
    }

    .status-message {
      background-color: #e3f2fd;
      color: #1976d2;
      border-radius: 4px;
      padding: 12px;
      margin: 10px 0;
      font-size: 14px;
    }

    .error-message {
      background-color: #ffebee;
      color: #c62828;
      border-radius: 4px;
      padding: 12px;
      margin: 10px 0;
      font-size: 14px;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: #666666;
    }

    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #0066cc;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .review-template {
      background-color: #f9f9f9;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .review-template:hover {
      transform: translateY(-2px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border-color: #0066cc;
    }

    .template-name {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .template-description {
      font-size: 12px;
      color: #666666;
      margin-bottom: 8px;
    }

    .check-list {
      list-style: none;
      padding: 0;
    }

    .check-item {
      font-size: 12px;
      color: #333333;
      padding: 4px 0;
      padding-left: 20px;
      position: relative;
    }

    .check-item::before {
      content: 'âœ“';
      position: absolute;
      left: 0;
      color: #4CAF50;
    }

    .review-results {
      margin-top: 12px;
    }

    .result-item {
      background-color: #f9f9f9;
      border-radius: 4px;
      padding: 12px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .result-check {
      flex: 1;
    }

    .result-text {
      font-weight: 500;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .result-notes {
      font-size: 12px;
      color: #666666;
    }

    .result-status {
      font-size: 12px;
      font-weight: 600;
      padding: 4px 12px;
      border-radius: 12px;
      margin-left: 12px;
    }

    .status-passed {
      background-color: #e8f5e8;
      color: #2e7d32;
    }

    .status-failed {
      background-color: #ffebee;
      color: #c62828;
    }

    .report-summary {
      background-color: #f0f0f0;
      border-radius: 6px;
      padding: 16px;
      margin-top: 12px;
    }

    .report-stat {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 13px;
      color: #666666;
    }

    .stat-value {
      font-weight: 600;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“ Figma Redlines</h1>
    
    <!-- æ ‡æ³¨å·¥å…· -->
    <div class="section">
      <h2>æ ‡æ³¨å·¥å…·</h2>
      <p style="font-size: 13px; color: #666666; margin-bottom: 12px;">é€‰æ‹©æ ‡æ³¨ç±»å‹å¹¶æ·»åŠ åˆ°è®¾è®¡</p>
      <div class="annotation-grid" id="annotation-types"></div>
      
      <div class="control-group" style="margin-top: 16px;">
        <div class="control-row">
          <label class="control-label">æ ‡æ³¨æ–‡æœ¬:</label>
          <input type="text" class="control-input" id="annotation-text" placeholder="è¾“å…¥æ ‡æ³¨å†…å®¹">
        </div>
      </div>
      
      <div class="button-group">
        <button class="btn" onclick="addAnnotation('TEXT')">æ·»åŠ æ–‡æœ¬æ ‡æ³¨</button>
        <button class="btn" onclick="addDimension()">æ·»åŠ å°ºå¯¸æ ‡æ³¨</button>
        <button class="btn" onclick="addSpacing()">æ·»åŠ é—´è·æ ‡æ³¨</button>
      </div>
    </div>

    <!-- è®¾è®¡å®¡æŸ¥ -->
    <div class="section">
      <h2>è®¾è®¡å®¡æŸ¥</h2>
      <p style="font-size: 13px; color: #666666; margin-bottom: 12px;">é€‰æ‹©å®¡æŸ¥æ¨¡æ¿è¿›è¡Œè®¾è®¡å®¡æŸ¥</p>
      <div id="review-templates"></div>
      <div id="review-results" style="margin-top: 16px;"></div>
    </div>

    <!-- æ ‡æ³¨ç®¡ç† -->
    <div class="section">
      <h2>æ ‡æ³¨ç®¡ç†</h2>
      <div class="button-group">
        <button class="btn" onclick="toggleAnnotations()">åˆ‡æ¢æ˜¾ç¤º</button>
        <button class="btn btn-secondary" onclick="exportAnnotations('pdf')">å¯¼å‡ºPDF</button>
        <button class="btn btn-secondary" onclick="exportAnnotations('png')">å¯¼å‡ºå›¾ç‰‡</button>
        <button class="btn btn-secondary" onclick="exportAnnotations('json')">å¯¼å‡ºJSON</button>
        <button class="btn btn-danger" onclick="clearAnnotations()">æ¸…é™¤æ‰€æœ‰æ ‡æ³¨</button>
      </div>
    </div>

    <!-- å®¡æŸ¥æŠ¥å‘Š -->
    <div class="section">
      <h2>å®¡æŸ¥æŠ¥å‘Š</h2>
      <button class="btn" onclick="createReviewReport()">åˆ›å»ºå®¡æŸ¥æŠ¥å‘Š</button>
      <div id="report-results" style="margin-top: 16px;"></div>
    </div>

    <!-- æ“ä½œç»“æœ -->
    <div class="section">
      <h2>æ“ä½œç»“æœ</h2>
      <div id="operation-results"></div>
    </div>
  </div>

  <script>
    // æ ‡æ³¨ç±»å‹æ•°æ®
    const annotationTypes = [
      {
        id: '1',
        name: 'å°ºå¯¸æ ‡æ³¨',
        description: 'æ ‡æ³¨å…ƒç´ çš„å®½é«˜å°ºå¯¸',
        type: 'DIMENSION',
        color: '#FF5722'
      },
      {
        id: '2',
        name: 'é—´è·æ ‡æ³¨',
        description: 'æ ‡æ³¨å…ƒç´ ä¹‹é—´çš„é—´è·',
        type: 'SPACING',
        color: '#2196F3'
      },
      {
        id: '3',
        name: 'æ–‡æœ¬æ ‡æ³¨',
        description: 'æ·»åŠ æ–‡æœ¬è¯´æ˜å’Œæ³¨é‡Š',
        type: 'TEXT',
        color: '#4CAF50'
      },
      {
        id: '4',
        name: 'é—®é¢˜æ ‡æ³¨',
        description: 'æ ‡æ³¨è®¾è®¡é—®é¢˜å’Œéœ€è¦ä¿®æ”¹çš„åœ°æ–¹',
        type: 'ISSUE',
        color: '#F44336'
      },
      {
        id: '5',
        name: 'å»ºè®®æ ‡æ³¨',
        description: 'æ ‡æ³¨è®¾è®¡å»ºè®®å’Œæ”¹è¿›æ„è§',
        type: 'SUGGESTION',
        color: '#FF9800'
      },
      {
        id: '6',
        name: 'å®Œæˆæ ‡æ³¨',
        description: 'æ ‡æ³¨å·²å®Œæˆçš„éƒ¨åˆ†',
        type: 'COMPLETED',
        color: '#9C27B0'
      }
    ];

    // å®¡æŸ¥æ¨¡æ¿æ•°æ®
    const reviewTemplates = [
      {
        id: '1',
        name: 'è§†è§‰ä¸€è‡´æ€§',
        description: 'æ£€æŸ¥é¢œè‰²ã€å­—ä½“ã€é—´è·ç­‰è§†è§‰å…ƒç´ çš„ä¸€è‡´æ€§',
        checks: [
          'é¢œè‰²ä½¿ç”¨æ˜¯å¦ä¸€è‡´',
          'å­—ä½“å¤§å°å’Œæ ·å¼æ˜¯å¦ç»Ÿä¸€',
          'é—´è·å’Œè¾¹è·æ˜¯å¦è§„èŒƒ',
          'å›¾æ ‡é£æ ¼æ˜¯å¦ä¸€è‡´'
        ]
      },
      {
        id: '2',
        name: 'å¯è®¿é—®æ€§',
        description: 'æ£€æŸ¥è®¾è®¡çš„å¯è®¿é—®æ€§å’Œæ— éšœç¢æ”¯æŒ',
        checks: [
          'é¢œè‰²å¯¹æ¯”åº¦æ˜¯å¦è¾¾æ ‡',
          'å­—ä½“å¤§å°æ˜¯å¦å¯è¯»',
          'æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç‚¹å‡»åŒºåŸŸ',
          'æ˜¯å¦æ”¯æŒé”®ç›˜å¯¼èˆª'
        ]
      },
      {
        id: '3',
        name: 'å“åº”å¼è®¾è®¡',
        description: 'æ£€æŸ¥è®¾è®¡åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„è¡¨ç°',
        checks: [
          'æ˜¯å¦é€‚é…ç§»åŠ¨ç«¯',
          'æ˜¯å¦é€‚é…å¹³æ¿è®¾å¤‡',
          'æ˜¯å¦é€‚é…æ¡Œé¢ç«¯',
          'å¸ƒå±€æ˜¯å¦çµæ´»é€‚åº”'
        ]
      },
      {
        id: '4',
        name: 'ç”¨æˆ·ä½“éªŒ',
        description: 'æ£€æŸ¥ç”¨æˆ·ä½“éªŒå’Œäº¤äº’è®¾è®¡',
        checks: [
          'å¯¼èˆªæ˜¯å¦æ¸…æ™°',
          'æ“ä½œæµç¨‹æ˜¯å¦é¡ºç•…',
          'åé¦ˆæ˜¯å¦åŠæ—¶',
          'é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„'
        ]
      }
    ];

    // åˆå§‹åŒ–é¡µé¢
    document.addEventListener('DOMContentLoaded', function() {
      renderAnnotationTypes();
      renderReviewTemplates();
    });

    // æ¸²æŸ“æ ‡æ³¨ç±»å‹
    function renderAnnotationTypes() {
      const typesContainer = document.getElementById('annotation-types');
      typesContainer.innerHTML = annotationTypes.map(type => `
        <div class="annotation-card" onclick="addAnnotation('${type.type}')">
          <div class="annotation-name">
            <span class="color-dot" style="background-color: ${type.color};"></span>
            ${type.name}
          </div>
          <div class="annotation-description">${type.description}</div>
        </div>
      `).join('');
    }

    // æ¸²æŸ“å®¡æŸ¥æ¨¡æ¿
    function renderReviewTemplates() {
      const templatesContainer = document.getElementById('review-templates');
      templatesContainer.innerHTML = reviewTemplates.map(template => `
        <div class="review-template" onclick="runReview('${template.id}')">
          <div class="template-name">${template.name}</div>
          <div class="template-description">${template.description}</div>
          <ul class="check-list">
            ${template.checks.slice(0, 3).map(check => `<li class="check-item">${check}</li>`).join('')}
            ${template.checks.length > 3 ? `<li class="check-item">...å…± ${template.checks.length} é¡¹æ£€æŸ¥</li>` : ''}
          </ul>
        </div>
      `).join('');
    }

    // å‘é€æ¶ˆæ¯åˆ°æ’ä»¶ä»£ç 
    function sendMessage(type, data = {}) {
      parent.postMessage({ pluginMessage: { type, ...data } }, '*');
    }

    // æ·»åŠ æ ‡æ³¨
    function addAnnotation(annotationType) {
      const text = document.getElementById('annotation-text').value;
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨æ·»åŠ æ ‡æ³¨...</div>';
      sendMessage('add-annotation', { annotationType, text, position: { x: 0, y: 0 } });
    }

    // æ·»åŠ å°ºå¯¸æ ‡æ³¨
    function addDimension() {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨æ·»åŠ å°ºå¯¸æ ‡æ³¨...</div>';
      sendMessage('add-dimension', { target: 'selected' });
    }

    // æ·»åŠ é—´è·æ ‡æ³¨
    function addSpacing() {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨æ·»åŠ é—´è·æ ‡æ³¨...</div>';
      sendMessage('add-spacing', { target1: 'selected1', target2: 'selected2' });
    }

    // è¿è¡Œå®¡æŸ¥
    function runReview(templateId) {
      const resultsDiv = document.getElementById('review-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨è¿è¡Œå®¡æŸ¥...</div>';
      sendMessage('run-review', { templateId });
    }

    // å¯¼å‡ºæ ‡æ³¨
    function exportAnnotations(format) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨å¯¼å‡ºæ ‡æ³¨...</div>';
      sendMessage('export-annotations', { format });
    }

    // æ¸…é™¤æ ‡æ³¨
    function clearAnnotations() {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨æ¸…é™¤æ ‡æ³¨...</div>';
      sendMessage('clear-annotations');
    }

    // åˆ‡æ¢æ ‡æ³¨æ˜¾ç¤º
    function toggleAnnotations() {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨åˆ‡æ¢æ ‡æ³¨æ˜¾ç¤º...</div>';
      sendMessage('toggle-annotations');
    }

    // åˆ›å»ºå®¡æŸ¥æŠ¥å‘Š
    function createReviewReport() {
      const resultsDiv = document.getElementById('report-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨åˆ›å»ºå®¡æŸ¥æŠ¥å‘Š...</div>';
      sendMessage('create-review-report');
    }

    // å¤„ç†æ¥è‡ªæ’ä»¶ä»£ç çš„æ¶ˆæ¯
    onmessage = (event) => {
      const { type, ...data } = event.data.pluginMessage;
      
      switch (type) {
        case 'annotation-added':
        case 'dimension-added':
        case 'spacing-added':
        case 'annotations-cleared':
        case 'annotations-toggled':
        case 'annotations-exported':
          handleStatusMessage(data.message);
          break;
        case 'review-completed':
          handleReviewCompleted(data);
          break;
        case 'report-created':
          handleReportCreated(data);
          break;
        case 'error':
          handleErrorMessage(data.message);
          break;
      }
    };

    // å¤„ç†çŠ¶æ€æ¶ˆæ¯
    function handleStatusMessage(message) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = `<div class="status-message">${message}</div>`;
    }

    // å¤„ç†å®¡æŸ¥å®Œæˆ
    function handleReviewCompleted(data) {
      const resultsDiv = document.getElementById('review-results');
      const results = data.results;
      
      let html = `<div class="status-message">${data.message}</div>`;
      html += '<h3 style="font-size: 14px; margin: 16px 0 8px;">å®¡æŸ¥ç»“æœ:</h3>';
      html += '<div class="review-results">';
      results.forEach(result => {
        const statusClass = result.status === 'passed' ? 'status-passed' : 'status-failed';
        const statusText = result.status === 'passed' ? 'é€šè¿‡' : 'æœªé€šè¿‡';
        html += `
          <div class="result-item">
            <div class="result-check">
              <div class="result-text">${result.check}</div>
              <div class="result-notes">${result.notes}</div>
            </div>
            <div class="result-status ${statusClass}">${statusText}</div>
          </div>
        `;
      });
      html += '</div>';
      
      resultsDiv.innerHTML = html;
    }

    // å¤„ç†æŠ¥å‘Šåˆ›å»º
    function handleReportCreated(data) {
      const resultsDiv = document.getElementById('report-results');
      const report = data.report;
      
      let html = `<div class="status-message">${data.message}</div>`;
      html += '<div class="report-summary">';
      html += '<h3 style="font-size: 14px; margin-bottom: 12px;">å®¡æŸ¥æŠ¥å‘Šæ‘˜è¦:</h3>';
      html += `
        <div class="report-stat">
          <span class="stat-label">æ€»æ ‡æ³¨æ•°:</span>
          <span class="stat-value">${report.totalAnnotations}</span>
        </div>
        <div class="report-stat">
          <span class="stat-label">é—®é¢˜æ•°:</span>
          <span class="stat-value">${report.issues}</span>
        </div>
        <div class="report-stat">
          <span class="stat-label">å»ºè®®æ•°:</span>
          <span class="stat-value">${report.suggestions}</span>
        </div>
        <div class="report-stat">
          <span class="stat-label">å·²å®Œæˆ:</span>
          <span class="stat-value">${report.completed}</span>
        </div>
      `;
      html += `<p style="margin-top: 12px; font-size: 13px; color: #666666;">${report.summary}</p>`;
      html += '</div>';
      
      resultsDiv.innerHTML = html;
    }

    // å¤„ç†é”™è¯¯æ¶ˆæ¯
    function handleErrorMessage(message) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = `<div class="error-message">${message}</div>`;
    }
  </script>
</body>
</html>
