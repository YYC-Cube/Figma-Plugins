<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Figma Remove BG</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #f5f5f5;
      color: #1a1a1a;
      line-height: 1.6;
    }

    .container {
      padding: 20px;
    }

    h1 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #1a1a1a;
    }

    h2 {
      font-size: 16px;
      font-weight: 600;
      margin: 20px 0 10px;
      color: #333333;
    }

    .section {
      background-color: white;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .btn {
      background-color: #0066cc;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
      margin-right: 8px;
      margin-bottom: 8px;
    }

    .btn:hover {
      background-color: #0052a3;
    }

    .btn-secondary {
      background-color: #666666;
    }

    .btn-secondary:hover {
      background-color: #525252;
    }

    .btn-danger {
      background-color: #dc3545;
    }

    .btn-danger:hover {
      background-color: #c82333;
    }

    .btn-success {
      background-color: #28a745;
    }

    .btn-success:hover {
      background-color: #218838;
    }

    .method-card {
      background-color: #f9f9f9;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .method-card:hover {
      border-color: #0066cc;
      background-color: #f0f0f0;
    }

    .method-card.selected {
      border-color: #0066cc;
      background-color: #e3f2fd;
    }

    .method-name {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .method-description {
      font-size: 12px;
      color: #666666;
    }

    .method-accuracy {
      display: inline-block;
      background-color: #4CAF50;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      margin-top: 8px;
    }

    .method-accuracy.medium {
      background-color: #FF9800;
    }

    .color-option {
      background-color: #f9f9f9;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .color-option:hover {
      border-color: #0066cc;
      background-color: #f0f0f0;
    }

    .color-option.selected {
      border-color: #0066cc;
      background-color: #e3f2fd;
    }

    .color-preview {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      border: 1px solid #e0e0e0;
    }

    .color-info {
      flex: 1;
    }

    .color-name {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .color-description {
      font-size: 12px;
      color: #666666;
    }

    .color-picker {
      width: 100%;
      padding: 8px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 14px;
      margin-top: 8px;
    }

    .status-message {
      background-color: #e3f2fd;
      color: #1976d2;
      border-radius: 4px;
      padding: 12px;
      margin: 10px 0;
      font-size: 14px;
    }

    .error-message {
      background-color: #ffebee;
      color: #c62828;
      border-radius: 4px;
      padding: 12px;
      margin: 10px 0;
      font-size: 14px;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: #666666;
    }

    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #0066cc;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .preview-area {
      background-color: #f9f9f9;
      border: 2px dashed #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      margin-top: 16px;
    }

    .preview-placeholder {
      color: #999999;
      font-size: 14px;
    }

    .export-options {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .export-option {
      flex: 1;
      padding: 12px;
      background-color: #f9f9f9;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .export-option:hover {
      border-color: #0066cc;
      background-color: #f0f0f0;
    }

    .export-option.selected {
      border-color: #0066cc;
      background-color: #e3f2fd;
    }

    .export-label {
      font-weight: 600;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ–¼ï¸ Figma Remove BG</h1>
    
    <!-- èƒŒæ™¯ç§»é™¤æ–¹æ³• -->
    <div class="section">
      <h2>é€‰æ‹©ç§»é™¤æ–¹æ³•</h2>
      <div id="removal-methods"></div>
    </div>

    <!-- èƒŒæ™¯é¢œè‰²é€‰é¡¹ -->
    <div class="section">
      <h2>èƒŒæ™¯é¢œè‰²</h2>
      <div id="bg-color-options"></div>
      <div id="custom-color-picker" style="display: none;">
        <label style="font-size: 14px; font-weight: 600; margin-bottom: 8px; display: block;">è‡ªå®šä¹‰é¢œè‰²</label>
        <input type="color" class="color-picker" id="custom-color-input" value="#FFFFFF">
      </div>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="section">
      <h2>æ“ä½œ</h2>
      <button class="btn" onclick="removeBackground()">ç§»é™¤èƒŒæ™¯</button>
      <button class="btn btn-secondary" onclick="previewResult()">é¢„è§ˆç»“æœ</button>
      <button class="btn btn-danger" onclick="undoRemoval()">æ’¤é”€</button>
      <button class="btn btn-success" onclick="batchRemove()">æ‰¹é‡å¤„ç†</button>
    </div>

    <!-- å¯¼å‡ºé€‰é¡¹ -->
    <div class="section">
      <h2>å¯¼å‡º</h2>
      <div class="export-options">
        <div class="export-option" onclick="exportImage('PNG')" data-format="PNG">
          <div class="export-label">PNG</div>
        </div>
        <div class="export-option" onclick="exportImage('JPG')" data-format="JPG">
          <div class="export-label">JPG</div>
        </div>
        <div class="export-option" onclick="exportImage('SVG')" data-format="SVG">
          <div class="export-label">SVG</div>
        </div>
        <div class="export-option" onclick="exportImage('WEBP')" data-format="WEBP">
          <div class="export-label">WEBP</div>
        </div>
      </div>
    </div>

    <!-- é¢„è§ˆåŒºåŸŸ -->
    <div class="section">
      <h2>é¢„è§ˆ</h2>
      <div class="preview-area" id="preview-area">
        <div class="preview-placeholder">é€‰æ‹©å›¾ç‰‡å¹¶ç‚¹å‡»"é¢„è§ˆç»“æœ"æŸ¥çœ‹æ•ˆæœ</div>
      </div>
    </div>

    <!-- æ“ä½œç»“æœ -->
    <div class="section">
      <h2>æ“ä½œç»“æœ</h2>
      <div id="operation-results"></div>
    </div>
  </div>

  <script>
    // èƒŒæ™¯ç§»é™¤æ–¹æ³•æ•°æ®
    const removalMethods = [
      {
        id: '1',
        name: 'AIæ™ºèƒ½ç§»é™¤',
        description: 'ä½¿ç”¨AIç®—æ³•æ™ºèƒ½è¯†åˆ«å¹¶ç§»é™¤èƒŒæ™¯',
        type: 'AI',
        accuracy: 'high'
      },
      {
        id: '2',
        name: 'é¢œè‰²é˜ˆå€¼ç§»é™¤',
        description: 'åŸºäºé¢œè‰²é˜ˆå€¼ç§»é™¤èƒŒæ™¯',
        type: 'COLOR_THRESHOLD',
        accuracy: 'medium'
      },
      {
        id: '3',
        name: 'è¾¹ç¼˜æ£€æµ‹ç§»é™¤',
        description: 'ä½¿ç”¨è¾¹ç¼˜æ£€æµ‹ç®—æ³•ç§»é™¤èƒŒæ™¯',
        type: 'EDGE_DETECTION',
        accuracy: 'medium'
      },
      {
        id: '4',
        name: 'æ‰‹åŠ¨é€‰æ‹©ç§»é™¤',
        description: 'æ‰‹åŠ¨é€‰æ‹©è¦ç§»é™¤çš„èƒŒæ™¯åŒºåŸŸ',
        type: 'MANUAL',
        accuracy: 'high'
      }
    ];

    // èƒŒæ™¯é¢œè‰²é€‰é¡¹æ•°æ®
    const bgColorOptions = [
      {
        id: '1',
        name: 'é€æ˜',
        description: 'ç§»é™¤èƒŒæ™¯åä½¿ç”¨é€æ˜èƒŒæ™¯',
        type: 'TRANSPARENT',
        color: 'transparent'
      },
      {
        id: '2',
        name: 'ç™½è‰²',
        description: 'ç§»é™¤èƒŒæ™¯åä½¿ç”¨ç™½è‰²èƒŒæ™¯',
        type: 'WHITE',
        color: '#FFFFFF'
      },
      {
        id: '3',
        name: 'é»‘è‰²',
        description: 'ç§»é™¤èƒŒæ™¯åä½¿ç”¨é»‘è‰²èƒŒæ™¯',
        type: 'BLACK',
        color: '#000000'
      },
      {
        id: '4',
        name: 'è‡ªå®šä¹‰é¢œè‰²',
        description: 'ç§»é™¤èƒŒæ™¯åä½¿ç”¨è‡ªå®šä¹‰é¢œè‰²',
        type: 'CUSTOM',
        color: '#FFFFFF'
      }
    ];

    let selectedMethod = 'AI';
    let selectedBgColor = 'TRANSPARENT';
    let customColor = '#FFFFFF';

    // åˆå§‹åŒ–é¡µé¢
    document.addEventListener('DOMContentLoaded', function() {
      renderRemovalMethods();
      renderBgColorOptions();
    });

    // æ¸²æŸ“èƒŒæ™¯ç§»é™¤æ–¹æ³•
    function renderRemovalMethods() {
      const methodsContainer = document.getElementById('removal-methods');
      methodsContainer.innerHTML = removalMethods.map(method => `
        <div class="method-card ${method.type === selectedMethod ? 'selected' : ''}" 
             onclick="selectMethod('${method.type}')" 
             data-method="${method.type}">
          <div class="method-name">${method.name}</div>
          <div class="method-description">${method.description}</div>
          <div class="method-accuracy ${method.accuracy === 'medium' ? 'medium' : ''}">${method.accuracy === 'high' ? 'é«˜ç²¾åº¦' : 'ä¸­ç­‰ç²¾åº¦'}</div>
        </div>
      `).join('');
    }

    // æ¸²æŸ“èƒŒæ™¯é¢œè‰²é€‰é¡¹
    function renderBgColorOptions() {
      const colorsContainer = document.getElementById('bg-color-options');
      colorsContainer.innerHTML = bgColorOptions.map(option => `
        <div class="color-option ${option.type === selectedBgColor ? 'selected' : ''}" 
             onclick="selectBgColor('${option.type}')" 
             data-color="${option.type}">
          <div class="color-preview" style="background-color: ${option.color}; ${option.color === 'transparent' ? 'background-image: linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%); background-size: 10px 10px; background-position: 0 0, 0 5px, 5px -5px, -5px 0px;' : ''}"></div>
          <div class="color-info">
            <div class="color-name">${option.name}</div>
            <div class="color-description">${option.description}</div>
          </div>
        </div>
      `).join('');

      // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰é¢œè‰²é€‰æ‹©å™¨
      const customColorPicker = document.getElementById('custom-color-picker');
      customColorPicker.style.display = selectedBgColor === 'CUSTOM' ? 'block' : 'none';
    }

    // é€‰æ‹©ç§»é™¤æ–¹æ³•
    function selectMethod(method) {
      selectedMethod = method;
      renderRemovalMethods();
    }

    // é€‰æ‹©èƒŒæ™¯é¢œè‰²
    function selectBgColor(color) {
      selectedBgColor = color;
      renderBgColorOptions();
    }

    // è‡ªå®šä¹‰é¢œè‰²å˜åŒ–
    document.getElementById('custom-color-input').addEventListener('change', function(e) {
      customColor = e.target.value;
    });

    // å‘é€æ¶ˆæ¯åˆ°æ’ä»¶ä»£ç 
    function sendMessage(type, data = {}) {
      parent.postMessage({ pluginMessage: { type, ...data } }, '*');
    }

    // ç§»é™¤èƒŒæ™¯
    function removeBackground() {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨ç§»é™¤èƒŒæ™¯...</div>';
      sendMessage('remove-background', { 
        method: selectedMethod, 
        bgColor: selectedBgColor,
        customColor: customColor
      });
    }

    // é¢„è§ˆç»“æœ
    function previewResult() {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨ç”Ÿæˆé¢„è§ˆ...</div>';
      sendMessage('preview-result');
    }

    // æ’¤é”€ç§»é™¤
    function undoRemoval() {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨æ’¤é”€...</div>';
      sendMessage('undo-removal');
    }

    // å¯¼å‡ºå›¾ç‰‡
    function exportImage(format) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = `<div class="loading"><div class="spinner"></div>æ­£åœ¨å¯¼å‡ºä¸º ${format} æ ¼å¼...</div>`;
      sendMessage('export-image', { format });
    }

    // æ‰¹é‡å¤„ç†
    function batchRemove() {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨æ‰¹é‡å¤„ç†...</div>';
      sendMessage('batch-remove', { 
        method: selectedMethod, 
        bgColor: selectedBgColor,
        customColor: customColor
      });
    }

    // å¤„ç†æ¥è‡ªæ’ä»¶ä»£ç çš„æ¶ˆæ¯
    onmessage = (event) => {
      const { type, ...data } = event.data.pluginMessage;
      
      switch (type) {
        case 'background-removed':
        case 'batch-removed':
          handleStatusMessage(data.message);
          updatePreviewArea();
          break;
        case 'preview-generated':
          handleStatusMessage(data.message);
          updatePreviewArea();
          break;
        case 'undo-completed':
          handleStatusMessage(data.message);
          resetPreviewArea();
          break;
        case 'image-exported':
          handleStatusMessage(data.message);
          break;
        case 'error':
          handleErrorMessage(data.message);
          break;
      }
    };

    // æ›´æ–°é¢„è§ˆåŒºåŸŸ
    function updatePreviewArea() {
      const previewArea = document.getElementById('preview-area');
      previewArea.innerHTML = `
        <div style="background-color: ${selectedBgColor === 'TRANSPARENT' ? 'transparent' : (selectedBgColor === 'CUSTOM' ? customColor : (selectedBgColor === 'WHITE' ? '#FFFFFF' : '#000000'))}; 
                    width: 100%; height: 200px; border-radius: 4px; 
                    ${selectedBgColor === 'TRANSPARENT' ? 'background-image: linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%); background-size: 10px 10px; background-position: 0 0, 0 5px, 5px -5px, -5px 0px;' : ''}">
          <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666666; font-size: 14px;">
            èƒŒæ™¯å·²ç§»é™¤
          </div>
        </div>
      `;
    }

    // é‡ç½®é¢„è§ˆåŒºåŸŸ
    function resetPreviewArea() {
      const previewArea = document.getElementById('preview-area');
      previewArea.innerHTML = '<div class="preview-placeholder">é€‰æ‹©å›¾ç‰‡å¹¶ç‚¹å‡»"é¢„è§ˆç»“æœ"æŸ¥çœ‹æ•ˆæœ</div>';
    }

    // å¤„ç†çŠ¶æ€æ¶ˆæ¯
    function handleStatusMessage(message) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = `<div class="status-message">${message}</div>`;
    }

    // å¤„ç†é”™è¯¯æ¶ˆæ¯
    function handleErrorMessage(message) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = `<div class="error-message">${message}</div>`;
    }
  </script>
</body>
</html>
