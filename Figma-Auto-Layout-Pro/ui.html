<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Figma Auto Layout Pro</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #f5f5f5;
      color: #1a1a1a;
      line-height: 1.6;
    }

    .container {
      padding: 20px;
    }

    h1 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #1a1a1a;
    }

    h2 {
      font-size: 16px;
      font-weight: 600;
      margin: 20px 0 10px;
      color: #333333;
    }

    .section {
      background-color: white;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .btn {
      background-color: #0066cc;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
      margin-right: 8px;
      margin-bottom: 8px;
    }

    .btn:hover {
      background-color: #0052a3;
    }

    .btn-secondary {
      background-color: #666666;
    }

    .btn-secondary:hover {
      background-color: #525252;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
    }

    .preset-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .preset-card {
      background-color: #f9f9f9;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 12px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .preset-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border-color: #0066cc;
    }

    .preset-name {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .preset-description {
      font-size: 12px;
      color: #666666;
      margin-bottom: 8px;
    }

    .preset-details {
      font-size: 11px;
      color: #999999;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .rule-list {
      margin-top: 12px;
    }

    .rule-item {
      background-color: #f9f9f9;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .rule-item:hover {
      background-color: #f0f0f0;
      border-color: #0066cc;
    }

    .rule-name {
      font-weight: 500;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .rule-description {
      font-size: 12px;
      color: #666666;
    }

    .control-group {
      margin: 12px 0;
    }

    .control-row {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    .control-label {
      width: 120px;
      font-size: 13px;
      color: #333333;
    }

    .control-input {
      flex: 1;
      padding: 6px 8px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 13px;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 12px 0;
    }

    .spacing-controls {
      display: flex;
      gap: 8px;
      margin: 12px 0;
    }

    .spacing-controls input {
      width: 80px;
      padding: 6px 8px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 13px;
    }

    .grid-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin: 12px 0;
    }

    .grid-control {
      display: flex;
      flex-direction: column;
      min-width: 100px;
    }

    .grid-control label {
      font-size: 12px;
      color: #666666;
      margin-bottom: 4px;
    }

    .grid-control input {
      padding: 6px 8px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 13px;
    }

    .status-message {
      background-color: #e3f2fd;
      color: #1976d2;
      border-radius: 4px;
      padding: 12px;
      margin: 10px 0;
      font-size: 14px;
    }

    .error-message {
      background-color: #ffebee;
      color: #c62828;
      border-radius: 4px;
      padding: 12px;
      margin: 10px 0;
      font-size: 14px;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: #666666;
    }

    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #0066cc;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“ Figma Auto Layout Pro</h1>
    
    <!-- å¸ƒå±€é¢„è®¾ -->
    <div class="section">
      <h2>å¸ƒå±€é¢„è®¾</h2>
      <p style="font-size: 13px; color: #666666; margin-bottom: 12px;">é€‰æ‹©å¹¶åº”ç”¨é¢„å®šä¹‰çš„å¸ƒå±€é…ç½®</p>
      <div class="preset-grid" id="layout-presets"></div>
    </div>

    <!-- æ™ºèƒ½å¸ƒå±€ -->
    <div class="section">
      <h2>æ™ºèƒ½å¸ƒå±€è§„åˆ™</h2>
      <p style="font-size: 13px; color: #666666; margin-bottom: 12px;">åº”ç”¨æ™ºèƒ½å¸ƒå±€è§„åˆ™ä¼˜åŒ–å…ƒç´ æ’åˆ—</p>
      <div class="rule-list" id="smart-rules"></div>
    </div>

    <!-- é—´è·è°ƒæ•´ -->
    <div class="section">
      <h2>é—´è·è°ƒæ•´</h2>
      <div class="spacing-controls">
        <input type="number" id="spacing-amount" value="4" min="1" max="100">
        <button class="btn" onclick="adjustSpacing('increase')">å¢åŠ é—´è·</button>
        <button class="btn" onclick="adjustSpacing('decrease')">å‡å°‘é—´è·</button>
      </div>
    </div>

    <!-- å…ƒç´ åˆ†å¸ƒä¸å¯¹é½ -->
    <div class="section">
      <h2>å…ƒç´ åˆ†å¸ƒä¸å¯¹é½</h2>
      <div class="button-group">
        <button class="btn btn-sm" onclick="distributeElements('horizontal')">æ°´å¹³åˆ†å¸ƒ</button>
        <button class="btn btn-sm" onclick="distributeElements('vertical')">å‚ç›´åˆ†å¸ƒ</button>
        <button class="btn btn-sm" onclick="alignElements('left')">å·¦å¯¹é½</button>
        <button class="btn btn-sm" onclick="alignElements('center')">æ°´å¹³å±…ä¸­</button>
        <button class="btn btn-sm" onclick="alignElements('right')">å³å¯¹é½</button>
        <button class="btn btn-sm" onclick="alignElements('top')">é¡¶éƒ¨å¯¹é½</button>
        <button class="btn btn-sm" onclick="alignElements('middle')">å‚ç›´å±…ä¸­</button>
        <button class="btn btn-sm" onclick="alignElements('bottom')">åº•éƒ¨å¯¹é½</button>
      </div>
    </div>

    <!-- ç½‘æ ¼åˆ›å»º -->
    <div class="section">
      <h2>ç½‘æ ¼åˆ›å»º</h2>
      <div class="grid-controls">
        <div class="grid-control">
          <label for="grid-columns">åˆ—æ•°</label>
          <input type="number" id="grid-columns" value="3" min="1" max="24">
        </div>
        <div class="grid-control">
          <label for="grid-rows">è¡Œæ•°</label>
          <input type="number" id="grid-rows" value="3" min="1" max="24">
        </div>
        <div class="grid-control">
          <label for="grid-gap">é—´è·</label>
          <input type="number" id="grid-gap" value="16" min="0" max="100">
        </div>
      </div>
      <button class="btn" onclick="createGrid()">åˆ›å»ºç½‘æ ¼</button>
    </div>

    <!-- æ‰¹é‡æ“ä½œ -->
    <div class="section">
      <h2>æ‰¹é‡æ“ä½œ</h2>
      <div class="button-group">
        <button class="btn" onclick="batchLayout('add')">æ‰¹é‡æ·»åŠ è‡ªåŠ¨å¸ƒå±€</button>
        <button class="btn" onclick="batchLayout('remove')">æ‰¹é‡ç§»é™¤è‡ªåŠ¨å¸ƒå±€</button>
        <button class="btn" onclick="convertToAutoLayout()">è½¬æ¢ä¸ºè‡ªåŠ¨å¸ƒå±€</button>
      </div>
    </div>

    <!-- æ“ä½œç»“æœ -->
    <div class="section">
      <h2>æ“ä½œç»“æœ</h2>
      <div id="operation-results"></div>
    </div>
  </div>

  <script>
    // å¸ƒå±€é¢„è®¾æ•°æ®
    const layoutPresets = [
      {
        id: '1',
        name: 'å‚ç›´å †æ ˆ',
        description: 'å‚ç›´æ’åˆ—å…ƒç´ ï¼Œå±…ä¸­å¯¹é½',
        direction: 'VERTICAL',
        alignment: 'CENTER',
        spacing: 16,
        padding: 16
      },
      {
        id: '2',
        name: 'æ°´å¹³å †æ ˆ',
        description: 'æ°´å¹³æ’åˆ—å…ƒç´ ï¼Œå±…ä¸­å¯¹é½',
        direction: 'HORIZONTAL',
        alignment: 'CENTER',
        spacing: 16,
        padding: 16
      },
      {
        id: '3',
        name: 'å¡ç‰‡å¸ƒå±€',
        description: 'å‚ç›´æ’åˆ—å…ƒç´ ï¼Œå·¦å¯¹é½ï¼Œå¸¦å†…è¾¹è·',
        direction: 'VERTICAL',
        alignment: 'MIN',
        spacing: 12,
        padding: 20
      },
      {
        id: '4',
        name: 'å¯¼èˆªæ ',
        description: 'æ°´å¹³æ’åˆ—å…ƒç´ ï¼Œå±…ä¸­å¯¹é½ï¼Œæœ€å°é«˜åº¦',
        direction: 'HORIZONTAL',
        alignment: 'CENTER',
        spacing: 24,
        padding: 16,
        minHeight: 60
      },
      {
        id: '5',
        name: 'è¡¨å•å¸ƒå±€',
        description: 'å‚ç›´æ’åˆ—å…ƒç´ ï¼Œå·¦å¯¹é½ï¼Œå¸¦æ ‡ç­¾é—´è·',
        direction: 'VERTICAL',
        alignment: 'MIN',
        spacing: 20,
        padding: 16
      },
      {
        id: '6',
        name: 'ç½‘æ ¼å¸ƒå±€',
        description: 'åˆ›å»ºå“åº”å¼ç½‘æ ¼å¸ƒå±€',
        direction: 'VERTICAL',
        alignment: 'MIN',
        spacing: 16,
        padding: 0,
        gridColumns: 3
      }
    ];

    // æ™ºèƒ½å¸ƒå±€è§„åˆ™æ•°æ®
    const smartLayoutRules = [
      {
        id: '1',
        name: 'ç­‰å®½åˆ†é…',
        description: 'å°†å®¹å™¨å®½åº¦å¹³å‡åˆ†é…ç»™å­å…ƒç´ ',
        type: 'EQUAL_WIDTH'
      },
      {
        id: '2',
        name: 'ç­‰é«˜æ°´å¹³å±…ä¸­',
        description: 'æ°´å¹³å±…ä¸­ä¸”ç­‰å®½æ’åˆ—å…ƒç´ ',
        type: 'EQUAL_WIDTH_CENTER'
      },
      {
        id: '3',
        name: 'ç­‰é«˜åˆ†é…',
        description: 'å°†å®¹å™¨é«˜åº¦å¹³å‡åˆ†é…ç»™å­å…ƒç´ ',
        type: 'EQUAL_HEIGHT'
      },
      {
        id: '4',
        name: 'ç­‰é«˜å‚ç›´å±…ä¸­',
        description: 'å‚ç›´å±…ä¸­ä¸”ç­‰é«˜æ’åˆ—å…ƒç´ ',
        type: 'EQUAL_HEIGHT_CENTER'
      },
      {
        id: '5',
        name: 'æœ€å¤§å®½åº¦ä¼˜å…ˆ',
        description: 'æ ¹æ®æœ€å¤§å…ƒç´ å®½åº¦è°ƒæ•´å¸ƒå±€',
        type: 'MAX_WIDTH'
      },
      {
        id: '6',
        name: 'æœ€å°å®½åº¦ä¼˜å…ˆ',
        description: 'æ ¹æ®æœ€å°å…ƒç´ å®½åº¦è°ƒæ•´å¸ƒå±€',
        type: 'MIN_WIDTH'
      }
    ];

    // åˆå§‹åŒ–é¡µé¢
    document.addEventListener('DOMContentLoaded', function() {
      renderLayoutPresets();
      renderSmartRules();
    });

    // æ¸²æŸ“å¸ƒå±€é¢„è®¾
    function renderLayoutPresets() {
      const presetsContainer = document.getElementById('layout-presets');
      presetsContainer.innerHTML = layoutPresets.map(preset => `
        <div class="preset-card" onclick="applyLayoutPreset('${preset.id}')">
          <div class="preset-name">${preset.name}</div>
          <div class="preset-description">${preset.description}</div>
          <div class="preset-details">
            <span>${preset.direction === 'VERTICAL' ? 'å‚ç›´' : 'æ°´å¹³'}</span>
            <span>é—´è·: ${preset.spacing}px</span>
            <span>å†…è¾¹è·: ${preset.padding}px</span>
          </div>
        </div>
      `).join('');
    }

    // æ¸²æŸ“æ™ºèƒ½å¸ƒå±€è§„åˆ™
    function renderSmartRules() {
      const rulesContainer = document.getElementById('smart-rules');
      rulesContainer.innerHTML = smartLayoutRules.map(rule => `
        <div class="rule-item" onclick="applySmartLayout('${rule.id}')">
          <div class="rule-name">${rule.name}</div>
          <div class="rule-description">${rule.description}</div>
        </div>
      `).join('');
    }

    // å‘é€æ¶ˆæ¯åˆ°æ’ä»¶ä»£ç 
    function sendMessage(type, data = {}) {
      parent.postMessage({ pluginMessage: { type, ...data } }, '*');
    }

    // åº”ç”¨å¸ƒå±€é¢„è®¾
    function applyLayoutPreset(presetId) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨åº”ç”¨å¸ƒå±€é¢„è®¾...</div>';
      sendMessage('apply-layout-preset', { presetId });
    }

    // åº”ç”¨æ™ºèƒ½å¸ƒå±€
    function applySmartLayout(ruleId) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨åº”ç”¨æ™ºèƒ½å¸ƒå±€è§„åˆ™...</div>';
      sendMessage('apply-smart-layout', { ruleId });
    }

    // è°ƒæ•´é—´è·
    function adjustSpacing(direction) {
      const amount = parseInt(document.getElementById('spacing-amount').value);
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = `<div class="loading"><div class="spinner"></div>æ­£åœ¨${direction === 'increase' ? 'å¢åŠ ' : 'å‡å°‘'}é—´è·...</div>`;
      sendMessage('adjust-spacing', { amount, direction });
    }

    // åˆ†å¸ƒå…ƒç´ 
    function distributeElements(direction) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = `<div class="loading"><div class="spinner"></div>æ­£åœ¨${direction === 'horizontal' ? 'æ°´å¹³' : 'å‚ç›´'}åˆ†å¸ƒå…ƒç´ ...</div>`;
      sendMessage('distribute-elements', { direction });
    }

    // å¯¹é½å…ƒç´ 
    function alignElements(alignType) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨å¯¹é½å…ƒç´ ...</div>';
      sendMessage('align-elements', { alignType });
    }

    // åˆ›å»ºç½‘æ ¼
    function createGrid() {
      const columns = parseInt(document.getElementById('grid-columns').value);
      const rows = parseInt(document.getElementById('grid-rows').value);
      const gap = parseInt(document.getElementById('grid-gap').value);
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨åˆ›å»ºç½‘æ ¼...</div>';
      sendMessage('create-grid', { columns, rows, gap });
    }

    // æ‰¹é‡å¸ƒå±€æ“ä½œ
    function batchLayout(operation) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = `<div class="loading"><div class="spinner"></div>æ­£åœ¨æ‰§è¡Œæ‰¹é‡${operation === 'add' ? 'æ·»åŠ ' : 'ç§»é™¤'}æ“ä½œ...</div>`;
      sendMessage('batch-layout', { operation });
    }

    // è½¬æ¢ä¸ºè‡ªåŠ¨å¸ƒå±€
    function convertToAutoLayout() {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨è½¬æ¢ä¸ºè‡ªåŠ¨å¸ƒå±€...</div>';
      sendMessage('convert-to-auto-layout');
    }

    // å¤„ç†æ¥è‡ªæ’ä»¶ä»£ç çš„æ¶ˆæ¯
    onmessage = (event) => {
      const { type, ...data } = event.data.pluginMessage;
      
      switch (type) {
        case 'preset-applied':
        case 'smart-layout-applied':
        case 'spacing-adjusted':
        case 'elements-distributed':
        case 'elements-aligned':
        case 'grid-created':
        case 'converted-to-auto-layout':
        case 'batch-operation-completed':
          handleStatusMessage(data.message);
          break;
        case 'error':
          handleErrorMessage(data.message);
          break;
      }
    };

    // å¤„ç†çŠ¶æ€æ¶ˆæ¯
    function handleStatusMessage(message) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = `<div class="status-message">${message}</div>`;
    }

    // å¤„ç†é”™è¯¯æ¶ˆæ¯
    function handleErrorMessage(message) {
      const resultsDiv = document.getElementById('operation-results');
      resultsDiv.innerHTML = `<div class="error-message">${message}</div>`;
    }
  </script>
</body>
</html>
